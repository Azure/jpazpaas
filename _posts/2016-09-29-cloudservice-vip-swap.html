---
title: "クラウドサービスで予約済み IP アドレスをご利用の際の注意点 (VIP スワップ)"
author_name: "Toshinao Onodera"
tags:
    - MigratedArticle
    - Cloud Services
---
<!-- article summary -->
<small><span style="font-style: italic">
この記事は <a href="https://docs.microsoft.com/ja-jp/archive/blogs/jpcie/クラウドサービスで予約済み-ip-アドレスをご利用">旧 Japan Azure PaaS Support Blog</a> からのコピーとなります。<br />
記載されている内容は 2016 年 9 月 29 日 時点のものとなり、現時点におきましては変更されている可能性がありますので、ご注意下さい。
</span></small><hr />
<main class="content" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
 <!-- <content> -->
 <p>
  こんにちは。CIE サポート 小野寺です。
  <br/>
  今回は CloudService に対して予約済み IP アドレスを割り当てた際の注意点についてお知らせします。
 </p>
 <p>
 </p>
 <hr/>
 <p>
  予約済み IP アドレスは、ご利用のリージョン内に割り当てられた IP アドレスを予約していただき、ずっとご利用いただくためのサービスです。
  <br/>
  予約済み IP アドレスが提供されるまでは、例えば同じクラウドサービス内のすべての仮想マシンを停止したり、すべてのインスタンスを削除した場合に、パブリック IP アドレスが変化することは避けられませんでした。
 </p>
 <p>
  しかし、仮想マシンの停止時やインスタンス削除時の IP アドレスの変更は、ユーザー様にとっては予期しない動作であることも多々あります。IP アドレスが変わってしまって接続ができないけど、修正にはかなりの工数がかかる、といったお問い合わせもちらほらと見受けられておりました。
 </p>
 <p>
  そんなときにこの予約済み IP アドレスというサービスが提供されましたが、クラウドサービスでこの機能を利用する場合には、一つ切っても切り離せない機能、VIP スワップがあります。ここでは VIP スワップをするためにはどのような環境を構築する必要があるのか、VIP スワップ時の IP アドレスの挙動について記載します。
 </p>
 <p>
 </p>
 <h4 id="avip-スワップをするためには本番ステージングそれぞれの環境に予約済み-ip-アドレスを割り当てる必要がある">
  A. VIP スワップをするためには、本番・ステージングそれぞれの環境に予約済み IP アドレスを割り当てる必要がある。
 </h4>
 <p>
  実は VIP スワップをするためには、本番・ステージングそれぞれに別々の予約済み IP アドレスを割り当てる必要があります。仮に、本番環境のみ VIP を割り当て、VIP スワップを試みますと、Powershell では以下のような結果が返却されます。
 </p>
 <p>
  <img alt="6E4856A9-78D5-469F-B945-A7E93BA5161C" data-linktype="external" src="/blog/media/2016/09/6E4856A9-78D5-469F-B945-A7E93BA5161C.png"/>
 </p>
 <p>
  クラウドサービスで予約済み IP アドレス + VIP スワップを利用する場合には、予約済み IP アドレスが二つ必要であること、本番とステージングそれぞれの環境に別の予約済み IP アドレスを紐づけることを忘れないようにしてください。
 </p>
 <p>
 </p>
 <h4 id="bvip-スワップ時の-ip-アドレスの挙動について">
  B. VIP スワップ時の IP アドレスの挙動について
 </h4>
 <p>
  VIP スワップをしても、予約済み IP アドレスは入れ替わりません。そのため、ステージング環境へのデプロイ時には
  <br/>
  はじめにステージング環境におこなった予約済み IP アドレスの構成設定を使うようにしてください。
 </p>
 <p>
  <img alt="33A5D259-7B2B-471B-8685-C5055EC6C2FF" data-linktype="external" src="/blog/media/2016/09/33A5D259-7B2B-471B-8685-C5055EC6C2FF.png"/>
 </p>
 <p>
  以上の点をご留意いただき、CloudService のご利用をご計画ください。また、実際に VIP スワップを実施する際に
  <br/>
  上記エラーに直面することもあるかと存じますので、そんなときの一助になれば幸いです。
 </p>
 <p>
 </p>
 <p>
 </p>
 <p>
  本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。
 </p>
 <!-- </content> -->
</main>
